This app is used by University of Wisconsin-Madison Physics and others to
coordinate building usage during the COVID-19 dirsuption.

Known to work in Debian 9 under Apache 2.4 with PHP 7.0.33 and MariaDB 10.1.44.

The .htaccess file assumes that shibboleth is set up to authenticate
people by NetID.  The code makes use of the shibboleth attributes cn
(or givenName and sn if cn is not available) and
wiscEduMSOLPrimaryAddress (or if not available, mail).

Download and install bootstrap into a directory named bootstrap (known
to work with version 4.1.3).

Copy config_example.php to config.php and edit it to match your
situation.

Copy approvals/ExampleDepartment.csv to
approvals/YourDepartmentName.csv and edit.  The department name used
for the csv file must match the department name in config.php with all
characters but alphabetic and numeric stripped.

Copy roomcaps/ExampleBuilding.csv to roomcaps/YourBuildingName.csv and
edit.  The building name used for the csv file must match the building
name in config.php with all characters but alphabetic and numeric
stripped.

Copy people/ExampleDepartment.csv to people/YourDepartmentName.csv and
edit.  This file is currently only used for listing people who are
approved to act as safety monitors, so if you aren't using that
feature, there is no need to configure this file.  All columns but
NETID are optional.  If a column URL is provided, it will be used in
place of a wisc.edu search for the person when the person is listed as
a safety monitor.  The department name used for the csv file must
match the department name in config.php with all characters but
alphabetic and numeric stripped.

Copy db_example.php to db.php and insert db access parameters.

Example of how to set up the database:

CREATE DATABASE building_access;

GRANT ALL ON building_access.* TO building_access_user@hostname IDENTIFIED BY 'password here';

USE building_access;

CREATE TABLE `building_access` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `NETID` varchar(60) NOT NULL,
  `NAME` varchar(120) NOT NULL,
  `EMAIL` varchar(60) NOT NULL,
  `PURPOSE` varchar(280) NOT NULL,
  `BUILDING` varchar(20) NOT NULL,
  `ROOM` varchar(60) NOT NULL,
  `REQUESTED` datetime NOT NULL,
  `START_TIME` datetime NOT NULL,
  `END_TIME` datetime NOT NULL,
  `APPROVED` char(1) NOT NULL,
  `APPROVED_TIME` datetime DEFAULT NULL,
  `APPROVED_BY` varchar(60) NOT NULL,
  `ADMIN_REASON` varchar(60) NOT NULL,
  `UPDATED` datetime NOT NULL,
  `DEPARTMENT` varchar(60) NOT NULL,
  `REPEAT_PARENT` int(11) NOT NULL,
  `REPEAT_DAYS` varchar(7) NOT NULL,
  `REPEAT_THROUGH` date DEFAULT NULL,
  `SAFETY_MONITOR` char(1) NOT NULL,
  PRIMARY KEY (`ID`),
  KEY `NETID` (`NETID`,`START_TIME`),
  KEY `START_TIME` (`START_TIME`),
  KEY `REPEAT_PARENT` (`REPEAT_PARENT`)
) ENGINE=InnoDB AUTO_INCREMENT=7281 DEFAULT CHARSET=utf8
